.\" -*- nroff -*-
.\" Copyright (c) 1998-2000  Roland Rosenfeld <roland@spinnaker.de>
.\"               
.\" This program is free software; you can redistribute it and/or modify
.\" it under the terms of the GNU General Public License as published by
.\" the Free Software Foundation; either version 2 of the License, or
.\" (at your option) any later version.
.\" 
.\" This program is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\" 
.\" You should have received a copy of the GNU General Public License
.\" along with this program; if not, write to the Free Software
.\" Foundation, Inc.,59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
.\"
.TH LBDBQ 1 "June 2000" "Unix" "User Manuals"
.SH NAME
lbdbq \- query program for the little brother's database
.SH SYNOPSIS
.B lbdbq
.I something
.br
.B lbdbq
.RB [ -v | -h ]
.SH DESCRIPTION
.B lbdbq
is the client program for the little brother's database. It will
attempt to invoke various modules to gather information about persons
matching
.IR something .
E.g., it may look at a list of addresses from which you have received
mail, it may look at YP maps, or it may try to finger
.IR something @ "<various hosts>" .
.PP
The behavior is configurable: Upon startup, 
.B lbdbq
will source the shell scripts:
.RS
.I @sysconfdir@/lbdb.rc
.br
.I $HOME/.lbdbrc
.br
.I $HOME/.lbdb/lbdbrc
.br
.I $HOME/.lbdb/rc
.RE
if they exist.
.PP
They can be used to set the following global variables:
.TP
.B MODULE_PATH
a space separated list of directories, where 
.B lbdbq
should look for modules.
.TP
.B METHODS
a space separated list of the modules to use.
.TP
.B SORT_OUTPUT
If you set this to 
.I false
or 
.IR no ,
lbdbq won't sort the addresses alphabetically by email address but
returns them in reverse order (which means that the most recent
address in m_inmail database is first).
.PP
Note that there 
.I are
defaults, so you should most
probably modify these variables using constructs like this:
.nf
       MODULE_PATH="$MODULE_PATH $HOME/lbdb_modules"
.fi
.PP
Additionally, modules may have configuration variables of
their own.
.SH MODULES
Currently, the following modules are supplied with lbdb:
.TP
.B m_finger
This module will use finger to find out something more about a person.
The list of hosts do be asked is configurable; use the 
.B M_FINGER_HOSTS
variable. Note that "localhost" will mean an invocation of your local
.BR finger (1)
binary, and should thus work even if you don't provide the finger
service to the network.
.B m_finger
tries to find out the machines mail domain name by parsing a
.I sendmail.cf
file (if it finds one) and by reading
.I /etc/hostname 
and
.IR /etc/HOSTNAME .
.TP
.B m_inmail
This module will look up user name fragments in a list of mail
addresses created by
.BR lbdb-fetchaddr (1).
.TP
.B m_passwd
This module searches for matching entries in your local /etc/passwd
file. It evaluates the local machine mail domain in the same way 
.B m_finger
does.
.TP
.B m_yppasswd
This module searches for matching entries in the NIS password database
using the command ``ypcat passwd''.
.TP
.BR m_pgp2 ", " m_pgp5 ", " m_gpg
These modules scan your PGP 2.*, PGP 5.* or GnuPG public key ring for
data. They use the programs
.BR pgp (1),
.BR pgpk (1),
or
.BR gpg (1)
to get the data.
.TP
.BR m_fido
This module searches your Fido nodelist, stored in
.I $HOME/.lbdb/nodelist
created by
.BR nodelist2lbdb (1).
.TP
.BR m_abook
This module uses the program
.BR abook (1),
a text based address book application to search for addresses.
.TP
.BR m_muttalias
This module searches the variable
.B MUTTALIAS_FILES
(a space separated list) of files in 
.B MUTT_DIRECTORY
that contain mutt aliases.  File names without leading slash will have
.B MUTT_DIRECTORY
(defaults to 
.BI $HOME /.mutt
or
.BR $HOME ,
if
.BI $HOME /.mutt
does not exist) prepended before the file name.  Absolute file names
(beginning with 
.IR / )
will be taken direct.
.TP
.BR m_pine
This module searches
.BR pine (1)
addressbook files for aliases.  To realize this it first inspects the
variable
.BR PINERC .
If it isn't set, the default 
.RI ` "/etc/pine.conf /etc/pine.conf.fixed .pinerc" '
is used.  To suppress inspecting the
.B PINERC
variable, set it to
.IR no .
It than takes all 
.B address-book
and
.B global-address-book
entries from these pinerc files and adds the contents of the variable
.B PINE_ADDRESSBOOKS
to the list, which defaults to
.RI ` "/etc/addressbook .addressbook" '.
Then these addressbooks are searched for aliases.  All filenames
without leading slash are searched in
.BR $HOME .
.PP
Feel free to create your own modules to query LDAP servers, YP maps,
and the like. 
.B m_finger
should be a good example of how to do it.
.PP
If you create your own modules or have other changes and feel that
they could be helpful for others, don't hesitate to submit them to the 
author for inclusion in later releases.
.PP
Finally, to use
.B lbdbq
from mutt, add the following line to your
.I $HOME/.muttrc:
.nf
    set query_command="lbdbq '%s'"
.fi
.SH OPTIONS
.IP -v
Print version number of lbdbq.
.IP -h
Print short help of lbdbq.
.SH FILES
.I @sysconfdir@/lbdb.rc
.br
.I $HOME/.lbdbrc
.br
.I $HOME/.lbdb/lbdbrc
.br
.I $HOME/.lbdb/rc
.br
.I @libdir@/*
.br
.I $HOME/.lbdb/m_inmail.list
.br
.I $HOME/.lbdb/nodelist
.SH "SEE ALSO"
.BR finger (1),
.BR ypcat (1),
.BR pgp (1),
.BR pgpk (1),
.BR gpg (1),
.BR mutt (1),
.BR lbdb-fetchaddr (1),
.BR nodelist2lbdb (1),
.BR abook (1),
.BR mutt (1),
.BR pine (1).
.SH CREDITS
Most of the really interesting code of this program (namely, the RFC
822 address parser used by lbdb-fetchaddr) was stolen from Michael
Elkins' mutt mail user agent. Additional credits go to Brandon Long
for putting the query functionality into mutt.
.SH AUTHOR
The lbdb package was written by Thomas Roessler <roessler@guug.de> and
is now maintained and extended by Roland Rosenfeld
<roland@spinnaker.de>.
